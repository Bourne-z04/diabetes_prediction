<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>针对糖尿病患者的健康方案定制系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            background-color: #f8f9fa;
            background-image: url('images/bg.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            scroll-behavior: smooth;
            padding-top: 0;
        }
        
        /* 添加全局覆盖层以增强文本可读性 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 半透明黑色覆盖 */
            z-index: -1;
        }
        
        /* 重新设计标题区域 */
        .header {
            background-image: none; /* 移除原来的背景，使用body背景 */
            padding: 0;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
            height: 100vh;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .header:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 70%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 60%),
                radial-gradient(circle at 80% 40%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 40%);
            z-index: 0;
        }
        
        .system-title {
            position: relative;
            z-index: 2;
            font-size: 5rem;
            font-weight: 900;
            color: #ffffff;
            text-align: center;
            margin-bottom: 3rem;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header-content {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
            z-index: 1;
            position: relative;
        }
        
        .header p {
            font-size: 1.5rem;
            opacity: 0.9;
            max-width: 80%;
            margin: 0 auto 1.5rem;
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: white;
            z-index: 10;
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0) translateX(-50%);
            }
            40% {
                transform: translateY(-20px) translateX(-50%);
            }
            60% {
                transform: translateY(-10px) translateX(-50%);
            }
        }
        
        .system-info {
            background-color: rgba(0, 0, 0, 0.5); /* 改为半透明黑色背景，与功能区一致 */
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 3rem;
            transition: transform 0.4s ease-out;
            color: #fff; /* 文字改为白色 */
            backdrop-filter: blur(5px); /* 添加模糊效果 */
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1); /* 添加微妙边框 */
        }
        
        .system-info:hover {
            transform: translateY(-5px) scale(1.01);
            background-color: rgba(0, 0, 0, 0.55); /* 悬停时稍微加深背景 */
        }
        
        /* 系统介绍区域内部标题样式 */
        .system-info .section-title {
            color: #ffffff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .feature-section {
            padding: 4rem 0;
            background: rgba(0, 0, 0, 0.5); /* 改为半透明黑色背景 */
            position: relative;
            overflow: hidden;
            color: #fff; /* 文字改为白色 */
        }
        
        .feature-section:before {
            content: none; /* 移除原有装饰效果 */
        }
        
        .feature-section:after {
            content: none; /* 移除原有装饰效果 */
        }
        
        .feature-card {
            text-align: center;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1); /* 半透明白色背景 */
            backdrop-filter: blur(5px); /* 模糊效果 */
            -webkit-backdrop-filter: blur(5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            height: 100%;
            transition: all 0.4s ease;
            position: relative;
            z-index: 1;
            overflow: hidden;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .feature-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
            z-index: -1;
            transition: all 0.4s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        .feature-card:hover:before {
            height: 100%;
        }
        
        .feature-icon {
            font-size: 3.5rem;
            color: #ffffff; /* 改为白色 */
            margin-bottom: 1.5rem;
            display: inline-block;
            transition: all 0.3s ease;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .feature-card:hover .feature-icon {
            transform: scale(1.1) rotate(5deg);
            color: #e5e5e5; /* 浅灰色 */
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            z-index: 1;
            color: #ffffff; /* 改为白色 */
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            margin: 1rem auto 0;
            border-radius: 2px;
        }
        
        .auth-section {
            padding: 6rem 0;
            background-color: transparent; /* 移除原来的背景色 */
            background-image: none; /* 移除原来的背景图 */
            position: relative;
        }
        
        .auth-section:before {
            content: none; /* 移除原来的伪元素 */
        }
        
        /* 确保表单区域内容可见 */
        .auth-form {
            background-color: rgba(255, 255, 255, 0.9); /* 半透明白色背景 */
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3); /* 更强的阴影 */
            padding: 2rem;
            border-radius: 8px;
            margin: 0 auto;
            max-width: 400px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .auth-form.active {
            opacity: 1;
            transform: translateY(0);
            z-index: 2;
        }
        
        .auth-form.inactive {
            opacity: 0;
            transform: translateY(-20px);
            z-index: 1;
        }
        
        .auth-forms-wrapper {
            position: relative;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .auth-title {
            color: var(--primary-color);
            margin-bottom: 3rem;
            text-align: center;
            font-weight: 700;
        }
        
        #result {
            padding: 1rem;
            margin: 1rem auto;
            border-radius: 8px;
            max-width: 600px;
            text-align: center;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1050;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .invalid-feedback {
            display: none;
            font-size: 0.875em;
            color: var(--danger-color);
        }
        
        .was-validated .form-control:invalid ~ .invalid-feedback {
            display: block;
        }
        
        .was-validated .form-control:invalid {
            border-color: var(--danger-color);
        }
        
        .was-validated .form-control:valid {
            border-color: var(--success-color);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        /* 页脚样式调整 */
        footer {
            background-color: rgba(33, 37, 41, 0.8) !important; /* 半透明深色背景 */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: relative;
            z-index: 10;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 4rem 0;
                min-height: 500px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .system-info {
                padding: 2rem;
            }
            
            .feature-card {
                margin-bottom: 2rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- 完全重构标题部分 -->
    <section class="header text-white" id="home">
        <h1 class="system-title">糖尿病健康方案定制系统</h1>
        <div class="container header-content">
            <p class="lead">为不同类型的糖尿病患者提供全面、个性化的健康管理服务</p>
            <a href="#features" class="btn btn-light btn-lg mt-3">
                <i class="fas fa-info-circle me-2"></i>了解更多
            </a>
        </div>
        <div class="scroll-indicator" onclick="document.getElementById('about').scrollIntoView({behavior: 'smooth'})">
            <div><i class="fas fa-chevron-down fa-2x"></i></div>
            <div class="small">滚动查看更多</div>
        </div>
    </section>

    <div class="container">
        <!-- 系统介绍 -->
        <section id="about" class="py-5">
            <div class="system-info" data-aos="fade-up">
                <h2 class="section-title"><i class="fas fa-info-circle me-2"></i>系统介绍</h2>
                <p class="mb-4">针对糖尿病患者的健康方案定制系统致力于为不同类型的糖尿病患者提供全面、个性化的健康管理服务。用户可以通过该系统进行注册、登录，查看个人健康信息、历史记录、专属健康指南，并能进行反馈。管理员则可对用户信息进行管理。</p>
                <p>系统会依据用户的各项健康数据，结合其糖尿病类型和运动量，生成个性化的健康方案，帮助患者更好地管理自身健康。通过多维度的数据分析和专业的健康建议，我们希望能够提高患者的生活质量，帮助他们科学地控制病情。</p>
            </div>
        </section>
    </div>

    <!-- 系统功能 -->
    <section class="feature-section" id="features">
        <div class="container">
            <h2 class="section-title" data-aos="fade-up"><i class="fas fa-cogs me-2"></i>主要功能</h2>
            <div class="row">
                <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h4>个性化健康方案</h4>
                        <p>根据不同糖尿病类型、运动量和健康数据，定制专属健康方案</p>
                    </div>
                </div>
                <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <h4>饮食指南</h4>
                        <p>提供早、中、晚三餐食谱，精确到食物名称和摄入量的个性化建议</p>
                    </div>
                </div>
                <div class="col-md-4" data-aos="fade-up" data-aos-delay="300">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h4>健康监测</h4>
                        <p>记录并分析血糖、体重、腰围等关键健康指标，追踪健康状况变化</p>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-running"></i>
                        </div>
                        <h4>运动建议</h4>
                        <p>根据用户运动量级别和身体状况，提供科学的运动计划</p>
                    </div>
                </div>
                <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <h4>用药指导</h4>
                        <p>根据患者类型和健康状况，提供用药建议和注意事项</p>
                    </div>
                </div>
                <div class="col-md-4" data-aos="fade-up" data-aos-delay="300">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <h4>每日反馈</h4>
                        <p>用户可对饮食、运动、心情、压力、睡眠等进行评分，系统持续优化健康方案</p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-5" data-aos="fade-up" data-aos-delay="400">
                <a href="#auth" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-sign-in-alt me-2"></i>立即体验
                </a>
                <a href="generate_prompt.html" class="btn btn-success btn-lg">
                    <i class="fas fa-magic me-2"></i>生成健康方案提示
                </a>
            </div>
        </div>
    </section>

    <!-- 认证表单区域 -->
    <section class="auth-section" id="auth">
        <div class="container">
            <!-- 结果提示区域 -->
            <div id="result" class="text-center" style="display: none;"></div>
            
            <h2 class="auth-title" data-aos="fade-up"><i class="fas fa-user-circle me-2"></i>加入我们</h2>
            
            <!-- 认证表单 -->
            <div class="auth-forms-wrapper" data-aos="fade-up" data-aos-delay="100">
                <div class="form-container" id="authFormsContainer">
                    <!-- 注册表单 -->
                    <div class="auth-form" id="registerForm" style="display: none;">
                        <h2><i class="fas fa-user-plus me-2"></i>注册账户</h2>
                        
                        <form id="registerFormContent" novalidate>
                            <div class="form-group mb-3">
                                <input type="text" class="form-control" id="reg-username" placeholder="用户名（3-20个字符）" required>
                                <div class="invalid-feedback">请输入用户名，用户名需要至少3个字符</div>
                            </div>
                            
                            <div class="form-group mb-3">
                                <input type="email" class="form-control" id="reg-email" placeholder="邮箱（格式：example@domain.com）" required>
                                <div class="invalid-feedback">请输入有效的电子邮箱地址</div>
                            </div>
                            
                            <div class="form-group mb-3">
                                <input type="password" class="form-control" id="reg-password" placeholder="密码（至少6个字符）" required>
                                <div class="invalid-feedback">密码必须至少包含6个字符</div>
                            </div>
                            
                            <button type="button" id="register-btn" class="btn btn-primary w-100" onclick="validateAndRegister()">注册</button>
                        </form>
                        
                        <a class="form-toggle-link" onclick="toggleForms()">已有账户？立即登录</a>
                    </div>

                    <!-- 登录表单 -->
                    <div class="auth-form active" id="loginForm">
                        <h2><i class="fas fa-sign-in-alt me-2"></i>账户登录</h2>
                        
                        <form id="loginFormContent" novalidate>
                            <div class="form-group mb-3">
                                <input type="text" class="form-control" id="login-email" placeholder="邮箱地址" required>
                                <div class="invalid-feedback">请输入您的邮箱</div>
                            </div>
                            
                            <div class="form-group mb-3">
                                <input type="password" class="form-control" id="login-password" placeholder="您的账户密码" required>
                                <div class="invalid-feedback">请输入您的密码</div>
                            </div>

                            <button type="button" id="login-btn" class="btn btn-primary w-100" onclick="validateAndLogin()">登录</button>
                        </form>
                        
                        <a class="form-toggle-link" onclick="toggleForms()">还没有账户？立即注册</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="text-white text-center py-4 mt-0">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-md-start">
                    <h5>糖尿病健康方案定制系统</h5>
                    <p class="small">提供精准的健康风险评估和个性化的健康方案</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">&copy; 2077 糖尿病健康方案定制系统 版权所有</p>
                    <div class="mt-2">
                        <a href="#" class="text-white me-2"><i class="fas fa-envelope"></i></a>
                        <a href="#" class="text-white me-2"><i class="fas fa-globe"></i></a>
                        <a href="#" class="text-white"><i class="fas fa-question-circle"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="app.js"></script>
    <script>
        // 初始化AOS动画库
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 检查是否已经登录
            const auth = checkAuth();
            if (auth && auth.currentUser) {
                // 添加一个参数防止无限重定向循环
                const preventLoop = new URLSearchParams(window.location.search).get('noredirect');
                if (preventLoop === 'true') {
                    console.log('已阻止重定向循环');
                    return; // 不执行重定向
                }
                
                // 如果token有效且用户信息存在，跳转到对应页面
                if (auth.currentUser.role_id === 2) { // 管理员
                    window.location.href = 'admin_dashboard.html';
                } else { // 普通用户
                    window.location.href = 'user_dashboard.html';
                }
                return; // 防止后续代码执行
            }
            
            // 添加滚动监听器，控制菜单高亮
            window.addEventListener('scroll', function() {
                let scrollDistance = window.scrollY;
                // 可以在这里添加导航栏的滚动逻辑（如果需要添加导航栏）
                
                // 如果滚动超过一定距离，可以添加"回到顶部"按钮
                if (scrollDistance > 500) {
                    // 显示回到顶部按钮
                } else {
                    // 隐藏回到顶部按钮
                }
            });
            
            // 初始化页面效果
            initPageEffects();
        });

        // 平滑滚动到指定区域
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({behavior: 'smooth'});
        }

        function toggleForms() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            if (loginForm.classList.contains('active')) {
                loginForm.classList.remove('active');
                loginForm.classList.add('inactive');
                // Delay display:none to allow animation
                setTimeout(() => {
                    loginForm.style.display = 'none';
                    registerForm.style.display = 'block';
                    registerForm.classList.remove('inactive');
                    registerForm.classList.add('active');
                }, 300); // Match animation duration
            } else {
                registerForm.classList.remove('active');
                registerForm.classList.add('inactive');
                setTimeout(() => {
                    registerForm.style.display = 'none';
                    loginForm.style.display = 'block';
                    loginForm.classList.remove('inactive');
                    loginForm.classList.add('active');
                }, 300); // Match animation duration
            }
        }

        function showResult(message, type) {
            const resultElement = document.getElementById('result');
            resultElement.textContent = message;
            resultElement.className = type;
            resultElement.style.display = 'block';
            
            // 3秒后自动隐藏消息
            setTimeout(() => {
                resultElement.style.display = 'none';
            }, 3000);
        }
        
        // 重写showMessage函数，使用自定义显示方式
        window.showMessage = function(message, type = 'success') {
            showResult(message, type);
        };

        // 表单验证和提交函数
        function validateAndRegister() {
            const form = document.getElementById('registerFormContent');
            const username = document.getElementById('reg-username').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-password').value;
            
            form.classList.add('was-validated');
            
            // 验证用户名
            if (username.length < 3) {
                document.getElementById('reg-username').classList.add('is-invalid');
                return;
            }
            
            // 验证邮箱
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                document.getElementById('reg-email').classList.add('is-invalid');
                return;
            }
            
            // 验证密码
            if (password.length < 6) {
                document.getElementById('reg-password').classList.add('is-invalid');
                return;
            }
            
            // 如果所有验证通过，则调用注册函数
            register();
        }
        
        function validateAndLogin() {
            const form = document.getElementById('loginFormContent');
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            form.classList.add('was-validated');
            
            // 验证邮箱
            if (!email) {
                document.getElementById('login-email').classList.add('is-invalid');
                return;
            }
            
            // 验证密码
            if (!password) {
                document.getElementById('login-password').classList.add('is-invalid');
                return;
            }
            
            // 重置表单验证状态
            document.getElementById('login-email').classList.remove('is-invalid');
            document.getElementById('login-password').classList.remove('is-invalid');
            
            // 如果所有验证通过，则调用登录函数
            login();
        }
    </script>
</body>
</html>